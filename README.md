# Домашнее задание ШРИ — Инфраструктура
Сервер можно запустить командой `make run-server`, агент — командой `make run-agent`.

Примеры конфигов лежат в файлах server-conf.example.json и agent-conf.example.json. (в agent-conf добавила дополнительное поле host).
* Сейчас все работает если в статусе Waiting только один билд и запущен только один агент. Очередь еще не делала.
## Прогресс:
- [x] Сервер:
  - [x] Сервер из конфига читает порт, на котором слушать и параметры для похода в API: base url, токен.
  - [x] Ходит за заданиями на сборку в базу (API) и передает задание на сборку одному из агентов.
  - [x] принимает результаты сборки и записывает их в БД (API).
  - [x] Для агентов предоставляет http-ручки:
    - [x] /notify-agent — зарегистрировать агента . В параметрах хост и порт, на котором запущен агент
    - [x] /notify-build-result — сохранить результаты сборки. В параметрах — id сборки, статус, лог (stdout и stderr процесса).
  - [x] Конфиг в файле server-conf.json
- [x] Агент:
  - [x] Из конфига читает порт, на котором слушать и хост/порт, на котором работает сервер.
  - [x] При запуске регистрируется в сервере (ручка /notify_agent), принимает задания на сборку, отсылает результаты на сервер
  - [x] Предоставляет ручки для сервера:
    - [x] /build — запустить сборку. В параметрах — id сборки, адрес репозитория, хэш коммита, команда, которую надо запустить
  - [x] Обработка задания на сборку: зачекаутить нужный коммит, запустить сборочную команду
  - [x] Передать статус и лог выполнения на сервер ручкой /notify_build_result
  - [x] Конфиг в файле agent-conf.json
- [ ] Требования
  - [ ] Сервер должен максимально утилизировать имеющихся агентов.
  - [ ] Сервер должен корректно обрабатывать ситуацию, когда агент прекратил работать между сборками.
  - [ ] Сервер должен корректно обрабатывать ситуацию, когда агент прекратил работать в процессе выполнения сборки.
  - [ ] Агент должен корректно обрабатывать ситуацию, когда при старте не смог соединиться с сервером.
  - [ ] Агент должен корректно обрабатывать ситуацию, когда при отправке результатов сборки не смог соединиться с сервером.
- [ ] Фикс багов и прочие улучшения:
  - [ ] Сделать проверки статусов ответов на запросы и переотправки в случае ошибки
  - [ ] Считать время сборки
  - [ ] Подключить eslint
  - [ ] Сделать очередь (сейчас не работает совсем)
  - [ ] Сделать ограничения на выполняемые команды (чтобы нельзя было сделать ничего кроме команд сборки)
  - [ ] Рефакторинг, убрать лишние выводы в консоль и добавить не лишние :)
- [ ] Исправить замечания ревьюера:
